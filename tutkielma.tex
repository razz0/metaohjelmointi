% --- Template for thesis / report with tktltiki2 class ---
% 
% last updated 2013/02/15 for tkltiki2 v1.02

\documentclass[finnish]{tktltiki2}

% --- General packages ---

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{microtype}
%\usepackage[table,xcdraw]{xcolor}    % loads also »colortbl«
%\usepackage{listings}
\usepackage{minted}
\usepackage{amsfonts,amsmath,amssymb,amsthm,booktabs,enumitem,graphicx}
\usepackage{tocloft}
%\usepackage{relsize}
\usepackage[pdftex,hidelinks]{hyperref}
\usepackage[title]{appendix}
%\usepackage{tabularx}
\usepackage[table]{xcolor}    % loads also »colortbl«
%\usepackage{float}

%\listfiles

\linespread{1.3}

\setlength{\intextsep}{18pt plus 2.0pt minus 2.0pt}

\lstset{%
  language=[LaTeX]TeX,
  basicstyle=\ttfamily,
  breaklines=true,
  columns=fullflexible,
}

%\setlength{\arrayrulewidth}{0.6pt}

% Automatically set the PDF metadata fields
\makeatletter
\AtBeginDocument{\hypersetup{pdftitle = {\@title}, pdfauthor = {\@author}}}
\makeatother

% --- Language-related settings ---
%
% these should be modified according to your language

% babelbib for non-english bibliography using bibtex
\usepackage[fixlanguage]{babelbib}
\selectbiblanguage{finnish}

% add bibliography to the table of contents
\usepackage[nottoc]{tocbibind}
% tocbibind renames the bibliography, use the following to change it back
\settocbibname{Lähteet}

\declarebtxcommands{finnish}{%
    \def\btxurldatecomment#1{ [#1]}%
}

\addto\captionsfinnish{
  \renewcommand{\lstlistingname}{Listaus}
  \renewcommand{\lstlistlistingname}{Listaukset}
}

% --- Theorem environment definitions ---
\newtheorem{lau}{Lause}
\newtheorem{lem}[lau]{Lemma}
\newtheorem{kor}[lau]{Korollaari}

\theoremstyle{definition}
\newtheorem{maar}[lau]{Määritelmä}
\newtheorem{ong}{Ongelma}
\newtheorem{alg}[lau]{Algoritmi}
\newtheorem{esim}[lau]{Esimerkki}

\theoremstyle{remark}
\newtheorem*{huom}{Huomautus}

% --- Custom hyphenations ---
\hyphenation{}

% --- tktltiki2 options ---
%
% The following commands define the information used to generate title and
% abstract pages. The following entries should be always specified:

\title{Metaohjelmointi Python-kielellä}
\author{Mikko Koho}
\date{\today}
\level{Seminaarityö}

\abstract{Tiivistelmä.
}

\keywords{Python, metaohjelmointi}
\classification{
}
% classification according to ACM Computing Classification System (http://www.acm.org/about/class/)
                  % This is probably mostly relevant for computer scientists

% If the automatic page number counting is not working as desired in your case,
% uncomment the following to manually set the number of pages displayed in the abstract page:
%
%\numberofpagesinformation{59 sivua + 7 liitesivua}
%


\begin{document}
    
% --- Front matter ---

\frontmatter      % roman page numbering for front matter

\maketitle        % title page

\makeabstract     % abstract page

\tableofcontents  % table of contents

% --- Main matter ---

\mainmatter       % clear page, start arabic page numbering


%%%%%%%%%%%%%%%%%%%
\section{Johdanto}
%%%%%%%%%%%%%%%%%%%

TODO: Johdanto.

%%%%%%%%%%%%%%%%%%%
\section{Python yleisesti}
%%%%%%%%%%%%%%%%%%%

%\subsection{Historia}

Ensimmäinen Python-kielen versio julkaistu 1991 [TODO: lähde]. Python-kielestä on nykyään käytössä eri versioita. Python 2.7 on edelleen melko suosittu vaikka versio 3 on julkaistu jo 2008. Versio 3 ei ole yhteensopiva aiempien versioiden kanssa. Version 2:n suosion taustalla on se, että monet suositut kirjastot ja sovelluskehykset eivät ole siirtyneet versioon 3. Tämän tekstin esimerkit toimivat sekä Python 2.7:llä että Python 3:lla, ellei toisin mainta.

Pythonin suosio on kasvanut tasaisesti ja se on nykyään käytetyin kieli ohjelmoinnin perusteiden opetukseen Yhdysvaltojen yliopistoissa \cite{python-teaching}.

Python-ohjelmakoodia voidaan kääntää useilla eri kääntäjillä \cite{martelli2006python}. Käytetyin kääntäjä on CPython (Classic Python), joka kääntää alkuperäisen koodin Python-tavukoodiksi. Tavukoodia ajetaan C-kielellä toteutetulla virtuaalikoneella \cite{martelli2006python}. Standardikirjasto on toteutettu osittain C:llä ja osittain Pythonilla.

Muita suosittuja kääntäjiä ovat Java-tavukoodiksi kääntävä Jython sekä IronPython, joka kääntää Python-koodia .NET-ympäristön käyttämäksi CIL-tavukoodiksi. PyPy on Python-kielellä toteutettu useissa eri ympäristöissä toimiva suoraan konekielelle koodia kääntävä ajonaikainen (just-in-time) kääntäjä. PyPy on toteutettu RPython-kielellä, joka on Python-kielen osajoukko.

Tässä luvussa käydään läpi Python-kielen perusteet.

\subsection{Pythonin syntaksi}

Python ohjelma koostuu loogisista riveistä, jotka ovat yhden tai useamman ''fyysisen'' rivin mittaisia. \cite{martelli2006python}. Loogisten rivien päättämiseen ei käytetä mitään merkkiä. Rivien sisennyksen perusteella erotetaan ohjelmakoodin lohkot toisistaan. Suositeltu tapa sisentää on käyttää ensimmäisen tason sisentämiseen 4 välilyöntiä ja seuraavaan 8 ja niin edelleen \cite{pep8}. 

\subsection{Operaattorit}

\subsection{Muuttujat}

Python on dynaamisesti tyypitetty kieli eli muuttujien arvon tyyppiä ei tarvitse eksplisiittisesti määrittää vaan tyyppi määräytyy sen perusteella minkälainen arvo muuttujaan sijoitetaan. Muuttujan tyyppiä voi myös vaihtaa sijoittamalla siihen uuden eri tyyppisen arvon. Listaus \ref{lst:ex1} sisältää yksinkertaisen esimerkin Python-kielen syntaksista. Ohjelma antaa tulosteet ''Hello World!'' ja ''12''.
%Modernit IDE:t kuten PyCharm\footnote{\url{https://www.jetbrains.com/pycharm/}} pystyvät koodin perusteella usein päättelemään muuttujan tyypin.

\begin{listing}
    \inputminted{python}{code/foo.py}
    \label{lst:ex1}
    \caption{Yksinkertainen esimerkki Python-kielen syntaksista.}
\end{listing}

Pythonissa kaikki arvot ovat olioita. Olion tyyppi määrittää mitä metodeja ja ominaisuuksia olio tarjoaa. Osa olioista on muuttumattomia (immutable) ja osa muutettavia (mutable).

%TODO: Esimerkkejä

\subsection{Muuttujatyyppejä}

\subsection{Iteroitavat}

Listakehitelmä (list comprehension), joukkokehitelmä (set comprehension) ja sanakirjakehitelmä (dictionary comprehension) ovat tapoja luoda lista-, joukko- tai sanakirjaolioita. 

Esimerkki listakehitelmän käytöstä sekä joistain Python-kielen funktioista on listauksessa \ref{lst:ex_listakehis}. Funktio \verb|range| palauttaa Python 2:ssa listan ja Python 3:ssa generaattoriolion, jota voidaan käyttää listan tapaan. Funktio \verb|all| tarkastaa kaikkien listan (tai muun iteroitavan olion) totuusarvon. Pythonissa kaikki oliot voidaan pakottaa evaluoitumaan totuusarvoina, jolloin lukujen tapauksessa aina luku ''0'' evaluoituu epätodeksi ja muut luvut todeksi.

\begin{listing}
    \inputminted{python}{code/luvut.py}
    \label{lst:ex_listakehis}
    \caption{Esimerkki funktion range() käytöstä ja listakehitelmistä.}
\end{listing}


\section{Python-kielen metaohjelmointimaisia komponentteja}

\subsection{Introspektio}

Introspektiolla tarkoitetaan tietojen hakemista muistissa olevista olioista, moduuleista ja funktioista \cite{dive-into-python}.

TODO: esimerkki kaikista perusjutuista: type, dir(), \_\_doc\_\_

\cite{dive-into-python}

\subsection{Metaluokat}

\subsection{Generaattorit}


Yield on metaohjelmointia.

\subsection{Lausekkeet}

Kuorruttajat(?) (decorator) \cite{dubois2005nest}.

Osittainsovellus (partial application).

%\subsection{Kontrollirakenteita}
%\subsection{Oliot}

%Funktionaaliset piirteet.

\section{Python-metaohjelmointi laajemmin}

Saako virtuaalikoneen statustietoja ulos?

Exec. Eval. Compile.

Käännösaikainen metaohjelmointi. Löytyykö template-kieliä?

\subsection{Reflektio}

In computer science, reflection is the ability of a computer program to examine (see type introspection) and modify the structure and behavior (specifically the values, meta-data, properties and functions) of the program at runtime.

reflektio (dir(), \_\_luokat\_\_). 




\subsection{Ohjelman ajonaikainen muokkaus}

metodien korvaaminen toisilla osoittimia muuttamalla. Monkey patching.

%%%%%%%%%%%%%%%%%%%%%
\section{Yhteenveto}
%%%%%%%%%%%%%%%%%%%%%

Yhteenveto.


\pagebreak

% --- References ---
%
% bibtex is used to generate the bibliography. The babplain style
% will generate numeric references (e.g. [1]) appropriate for theoretical
% computer science. If you need alphanumeric references (e.g [Tur90]), use
%
% \bibliographystyle{babalpha-lf}
%
% instead.

\bibliographystyle{babalpha-lf}
\bibliography{references-fi}

\lastpage

\end{document}
